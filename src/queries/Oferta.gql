# CRUD OFERTA
#  BUSCAR
query ofertaBuscar($busqueda: BuscarOfertaDto!) {
  ofertaBuscar(
    busqueda: $busqueda
    opciones: { populate: true, limit: 10, buscarCatalogo: true }
  ) {
    _id
    _creado
    nombre
    abreviacion
    descripcion
    catalogo {
      _id
      nombre
    }
    precio
    grupos
    preparados {
      producto {
        _id
      }
      cantidad
    }
    ingredientes {
      ... on IngredienteProducto {
        _id
        _tipo
        producto {
          _id
          nombre
          presentacionBasica
          presentaciones {
            cantidad
            nombre
          }
        }
        cantidad
      }
      ... on IngredienteGrupo {
        _id
        _tipo
        grupo
      }
    }
    imagen {
      cloudinaryUrl
    }
  }
}
# CREAR
mutation crearOferta($datos: CrearOfertaDto!) {
  ofertaCrear(datos: $datos) {
    _id
    nombre
    abreviacion
    descripcion
    precio
    grupos
    catalogo {
      _id
      nombre
    }
    imagen {
      cloudinaryUrl
    }
  }
}
# EDITAR
mutation modificarOfertas(
  $busqueda: BuscarOfertaDto!
  $datos: ModificarOfertaDto!
) {
  ofertaModificar(busqueda: $busqueda, datos: $datos, opciones: { limit: 0 }) {
    _id
    nombre
    descripcion
    abreviacion
    imagen {
      cloudinaryUrl
    }
  }
}
# BORRAR
# mutation borrarOfertas($busqueda: BuscarOfertaDto!) {
#   ofertaBorrar(busqueda: $busqueda, opciones: { limit: 0 })
# }
mutation borrarOfertas($busqueda: BuscarOfertaDto!) {
  ofertaBorrar(busqueda: $busqueda, opciones: { limit: 1 }) {
    _id
    nombre
  }
}

mutation crearIngredienteProducto(
  $busqueda: BuscarOfertaDto!
  $datos: CrearIngredienteProductoDto!
) {
  ofertaCrearIngredienteProducto(
    busqueda: $busqueda
    datos: $datos
    opciones: { populate: true }
  ) {
    ... on IngredienteProducto {
      _id
      _tipo
      producto {
        nombre
      }
      cantidad
    }
  }
}
mutation editarIngredienteProducto(
  $busqueda: BuscarOfertaDto!
  $datos: ModificarIngredienteProductoDto!
  $busquedaIngrediente: BuscarIngredienteDto!
) {
  ofertaModificarIngredienteProducto(
    busqueda: $busqueda
    datos: $datos
    busquedaIngrediente: $busquedaIngrediente
    opciones: { populate: true }
  ) {
    _id
    _tipo
    producto {
      nombre
    }
    cantidad
  }
}

# BUSCAR PRODUCTO CON SUS PRESENTACIONES PARA AGREGAR PRODUCTO FIJO A OFERTA
query ofertaProductoBuscar($busqueda: BuscarProductoDto!) {
  productoBuscar(busqueda: $busqueda, opciones: { limit: 0 }) {
    _id
    nombre
    presentacionBasica
    presentaciones {
      cantidad
      nombre
    }
  }
}

# CATALOGOS
query buscarCatalogos($busqueda: BuscarCatalogoDto!) {
  catalogoArbol(busqueda: $busqueda, opciones: { populate: true }) {
    _id
    nombre
    ofertas {
      nombre
    }
    hijas {
      _id
      nombre
      ofertas {
        nombre
      }
      hijas {
        _id
        nombre
        ofertas {
          _id
          nombre
        }
        hijas {
          _id
          nombre
          ofertas {
            nombre
          }
        }
      }
    }
  }
}

query buscarCatalogos2($busqueda: BuscarCatalogoDto!) {
  catalogoArbol(busqueda: $busqueda, opciones: { populate: true }) {
    _id
    nombre
    hijas {
      _id
      nombre
    }
  }
}

# query buscarCatalogoID($busqueda: BuscarCatalogoDto!) {
#   catalogoArbol(busqueda: $busqueda, opciones: { populate: true }) {
#     _id
#     nombre
#     ofertas {
#       nombre
#     }
#     hijas {
#       _id
#       nombre
#       ofertas {
#         nombre
#       }
#       hijas {
#         _id
#         nombre
#         ofertas {
#           nombre
#         }
#       }
#     }
#   }
# }

mutation crearCatalogo($datos: CrearCatalogoDto!) {
  catalogoCrear(datos: $datos, opciones: { populate: true }) {
    _id
    nombre
    pariente {
      nombre
    }
    ofertas {
      nombre
    }
  }
}
# MENU - CATALOGO
query puntoLeerCatalogo(
  $busqueda: BuscarEntidadDto!
  $busquedaMenu: BuscarMenuDto!
) {
  entidadLeerMenu(
    busqueda: $busqueda
    busquedaMenu: $busquedaMenu
    opciones: { populate: true }
  ) {
    _id
    nombre
    hijas {
      _id
      nombre
      ofertas {
        nombre
      }
      hijas {
        _id
        nombre
        ofertas {
          _id
          nombre
        }
      }
    }
    ofertas {
      _id
      nombre
      ingredientes {
        ... on IngredienteProducto {
          _id
        }
        ... on IngredienteEleccion {
          cantidadMax
        }
      }
    }
  }
}

# CATALOGO RECURSIVO
query catalogoOfertasRecursivo($busqueda: BuscarCatalogoDto!) {
  catalogoOfertasRecursivo(busqueda: $busqueda, opciones: { populate: true }) {
    _id
    _creado
    _modificado
    nombre
    abreviacion
    descripcion
    catalogo {
      _id
      nombre
    }
    precio
    grupos
    preparados {
      producto {
        _id
      }
      cantidad
    }
    ingredientes {
      ... on IngredienteProducto {
        _id
        _tipo
        producto {
          _id
          nombre
          presentacionBasica
          presentaciones {
            cantidad
            nombre
          }
        }
        cantidad
      }
      ... on IngredienteGrupo {
        _id
        _tipo
        grupo
      }
    }
    imagen {
      cloudinaryUrl
    }
  }
}
